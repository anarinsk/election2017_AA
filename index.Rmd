---
title: "2017 한국 대선결과 분석: Archetypal analysis"
author: "JSH"
date: '2017 5 20 '
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# 들어가며
- - - -

* 이 포스팅은 2017년 한국 대선결과를 2016년 총선의 비례대표 결과와 비교하기 위한 목적으로 작성되었습니다. 
* 분석의 목적보다는 archetypal analysis(이하 AA)를 소개하고, AA를 통해서 선거 결과를 어떻게 해석하는지에 중점을 둘 예정입니다. 

## 데이터에 관해 

* 본 자료는 2017년의 경우 선관위 홈페이지에 공개된 개표 결과를 웹 크롤링한 결과입니다. 2016년 대선 결과의 경우 선관위 자료실의 xlsx 파일을 가공하였습니다. 
* 자료의 해상도는 "읍면동" 단위를 활용했습니다. 가장 높은 해상도를 위해서는 "투표구" 단위를 활용할 수 있습니다. 그럼에도 투표구 단위의 자료를 활용하지 않은 이유는 다음과 같습니다. 
    * 비록 1년 정도의 시차를 지니지만, 꽤 많은 지역에서 투표구의 명칭 및 영역에 변화가 있었습니다. 시간을 두고 해당 변화를 따라가는 작업을 거치면 가능하겠지만, 현재 상태로 이런 작업은 무리입니다. 
    * 선거 결과의 추세를 살펴보는 데에는 읍면동 단위의 자료로도 충분하리라고 사전적으로 판단했습니다. 

## 데이터 로딩과 패키지 설치

* 본 분석은 기본적으로 일정하게 가공된 데이터를 R에 로딩한 상태에서 출발하는 것을 전제로 합니다. `tidy_0514.RData` 파일이 R에 로딩되어 있는 것을 가정합니다. 
* 본 분석이 활용하는 패키지의 설치 역시 완결되어 있다고 가정합니다. 

# 분석 방법 
- - - -

## AA에 대한 간략한 소개 

보통 카테고리화 혹은 클러스터링은 차원축소(dimensionality reduction)의 한 방편입니다. 하나의 관찰 값이 지니는 특성(feature)가 여러개 있다고 생각해봅시다. 이때 해당 관찰의 특징을 인간이 파악하기 위해서는 이 여러가지 특성을 몇가지로 묶을 필요가 있습니다. 즉, $n$개의 특성이 있다면, 이를 식별가능한 $k$개로 줄이는 작업입니다. 물론, $k$값이 작으면 작을수록 좋습니다. 다른 한편으로, 이 값이 개별 관측치의 차이를 잘 요약할 수 있어야 하기 때문에 지나치게 낮아질 수는 없습니다. 

클러스터링의 방법으로 가장 잘 알려진 것은 kmeans가 있습니다. PCA로 줄여쓰곤 하는 Principal Component Analysis 역시 차원축소에 잘 알려진 방법의 하나입니다. 차원축소 자체를 논하는 자리는 아니니 만큼 이에 대한 파악은 각자에게 맡기도록 하겠습니다. 

클러스팅에서 가장 일반적으로 쓰는 방법은 kmeans입니다. 한마디로 말하면, 이 방법은 해당 클러스터의 중심을 설정하고 이 중심과 이 중심에 속하게 될 개별 관찰 사이의 거리를 최소화하는 방식으로 계산됩니다. kmeans는 중심(centroid)에 기반한 방법입니다. 그런데, 이렇게 중심에 기반한 방법은 해당 카테고리의 특징을 잘 잡아낼수도 있지만 반대로 이들이 지닌 뾰족한 특징을 감추는 역할을 합니다. 중심에 기반한 방법이 지닌 어쩔 수 없는 한계라고 봐야 할 것입니다. 

이러한 중심 기반의 방법론이 지닌 한계에 대한 대안으로 물리학에서 활용되던 방법을 활용해 만들어진 것이 AA입니다. 원형(archetype)이라는 말엣 짐작하실 수 있듯이, 이 방법은 관찰값을 생성할 수 있는 기저(bases)가 어떤 것인지를 찾는 것을 목표로 합니다. 그리고 해당 데이터들의 대체로 이 기저들의 볼록선체(convex hull)를 통해 만들어질 수 있어야 합니다. 즉, 기술적인 세부사항을 과감히 무시하고 말하자면, AA는 관찰값을 생성할 수 있는 기본적 혹은 극단적인 원형이 무엇인지를 찾는 것입니다. 만일 우리가 어떤 특성을 그 기본에서 유래하는 것이라고 보는 것이 타당할 때 이 방법은 중심에 의지하는 방법론에 비해서 훨씬 더 사태를 잘 드러낼 수 있을 것이라고 기대할 수 있을 것입니다. 

## 선거 자료 분석에 대한 AA의 적절성 

사실, 이는 저의 전문 분야가 아니기 때문에 이야기하기에 조심스럽습니다. 그렇지만, 두 가지 점에서 AA분석이 흥미로운 시사점을 제공한다고 할 수 있을 것입니다. 우선, 선거결과란 결국 어떤 총합입니다. 우리는 흔히 선거에서 바람이나 구도를 이야기합니다. 이는 평균이라는 결과로 나타나지만 그 평균을 당기는 어떤 힘을 이야기합니다. AA 분석은 이런 힘의 실체를 계량화할 수 있는 하나의 방법이 될 수 있을 것입니다. 둘째, 만일 이런 원형의 특징이 시점간에 유지된다고 볼 수 있다면 그 원형이 어떻게 이동했는지를 살펴봄으로써 바람이나 구도가 어떻게 변화했는지 살필 수 있을 것입니다. 

## 이번 선거와 관련해 특별히 흥미로운 점 

2012년 대선만 해도 대체로 양자 구도였던 대통령 선거가 올해 갑자기 치러진 선거에서는 다자구도로 변화했습니다. 물론 이러한 다자구도로의 전환은 2016년 총선에서 거둔 국민의당의 선전에서 이미 확립된 것입니다. 우리가 그다지 원하지 않았던 자연실험이지만, 2016년 국민의당이 대변했던 이른바 '중도층'의 분화로서의 다자구도의 변화, 그리고 2017년 대통령 탄핵으로 인해 갑자기 치뤄진 구여권(새누리당 계열) 약화 하의 다자구도의 변화 모두를 살필 수 있는 좋은 자료가 아닐까 합니다. 

# Step-by-step tutorial 

이제 거두절미하고 AA 분석과 필요한 R code를 소개해볼까 합니다. 다시 말하지만 이 포스팅의 목적은 AA를 R에서 실행하는 과정을 재현하는 데 있습니다. 또한 앞서 밝혔듯이 글의 주제가 전공 분야가 아니기에 결과에 더해 살짝 의견을 덧붙이는 정도로만 생각을 담을까 합니다. 물론 비판이나 코멘트는 환영합니다 
  
## 패키지 로딩

* tudyverse와 archetypes 패키지는 설치되었다고 가정 

```{r package}
load("data/tidy_20170514.RData")
library(tidyverse)
library(archetypes)
options(warn=-1)
```

## 데이터 정리 

```{r df_UMD}
df_UMD %>% 
  mutate(
    voted_rate = pop_voted/pop_vote,
    Yoo = NULL, 
    Moon_shr = Moon / pop_voted, 
    Hong_shr = Hong / pop_voted, 
    Ahn_shr = Ahn / pop_voted,  
    Sim_shr = Sim / pop_voted, 
    year = year 
  ) %>% 
  select(one_of('local_1', 'local_2', 'UMD', 'year', 'pop_vote', 'voted_rate', 
                'Moon_shr', 'Hong_shr', 'Ahn_shr', 'Sim_shr')) -> UMD_shr
```

1. df_UMD는 2016년 선거와 2017년 선거의 결과를 읍면동 단위로 정리해 둔 data.frame 객체입니다. 이 원자료를 기반으로 투표율 및 각 후보의 지지율로 바꿉니다. 
2. 그리고 필요한 column만을 취해 `UMD_shr` data.frame을 만듭니다. 

```{r}
ungroup(UMD_shr) %>% 
  filter(year == 2016) %>% 
  select(one_of('pop_vote', 'voted_rate', 'Moon_shr', 'Hong_shr', 'Ahn_shr', 'Sim_shr'))-> tdf 
```

1. UMD_shr가 `group_by`로 묶여 있을 경우 이후 데이터 처리에 문제가 생길 수 있습니다. 이를 방지해주는 것이 `ungroup()`명령어입니다. 
2. 먼저 2016년 자료를 걸러내고 AA의 feature로 삼을 대상을 걸러냅니다. 여기서는 다음과 같은 6개가지를 feature로 삼고자 합니다. 
    1. `pop_vote`: 유권자 수 
    2. `voted_rate`: 투표율 
    3. `Moon_shr`: 더불어민주당 비례 득표율 
    4. `Hong_shr`: 새누리당 비례 득표율 
    5. `Ahn_shr`: 국민의당 비례 득표율 
    6. `Sim_shr`: 정의당 비례 득표율 

```{r}
as <- stepArchetypes(data = tdf, k = 1:10, verbose = FALSE, nrep = 4)
screeplot(as)
```

